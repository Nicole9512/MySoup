InnoDB
=====================

# 一、简介
* InnoDB 存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但是对比 MyISAM 的存储引擎，InnoDB 写的处理效率差一些并且会占用更多的磁盘空间以保留数据和索引。

# 二、自增
* InnoDB 表的自动增长列可以手工插入，但是插入的值如果是空或者 0，则实际插入的将是自动增长后的值。下面定义新表 autoincre_demo，其中列 i 使用自动增长列，对该表插入记录，然后查看自动增长列的处理情况，可以发现插入 0 或者空实际插入的都将是自动增长后的值。
* 可以通过“ALTER TABLE *** AUTO_INCREMENT = n;”语句强制设置自动增长列的初识值，默认从 1 开始，但是该强制的默认值是保留在内存中的，如果该值在使用之前数据库重新启动，那么这个强制的默认值就会丢失，就需要在数据库启动以后重新设置。
* 对于 InnoDB 表，自动增长列必须是索引。如果是组合索引，也必须是组合索引的第一列，但是对于 MyISAM 表，自动增长列可以是组合索引的其他列，这样插入记录后，自动增长列是按照组合索引的前面几列进行排序后递增的。例如，创建一个新的 MyISAM 类型的表 autoincre_demo，自动增长列 d1 作为组合索引的第二列，对该表插入一些记录后，可以发 现自动增长列是按照组合索引的第一列 d2 进行排序后递增的。

# 三、外键
* MySQL 支持外键的存储引擎只有 InnoDB，在创建外键的时候，要求父表必须有对应的索引，子表在创建外键的时候也会自动创建对应的索引。

# 四、存储方式
* InnoDB 存储表和索引有以下两种方式。
## 1.使用共享表空间存储
* 这种方式创建的表的表结构保存在.frm 文件中，数据和索引保存在 innodb_data_home_dir 和 innodb_data_file_path 定义的表空间中，可以是
多个文件。
## 2.使用多表空间存储
* 这种方式创建的表的表结构仍然保存在.frm 文件中，但是每个表的数据和索引单独保存在.ibd 中。如果是个分区表，则每个分区对应单独的.ibd 文件，文件名是“表名+分区名”，可以在创建分区的时候指定每个分区的数据文件 的位置，以此来将表的 IO 均匀分布在多个磁盘上。
## 3.存储方式的选择
* 要使用多表空间的存储方式，需要设置参数 innodb_file_per_table，并重新启动服务后才可以生效，对于新建的表按照多表空间的方式创建，已有的表仍然使用共享表空间存储。 如果将已有的多表空间方式修改回共享表空间的方式，则新建表会在共享表空间中创建，但 已有的多表空间的表仍然保存原来的访问方式。所以多表空间的参数生效后，只对新建的表生效。
* 多表空间的数据文件没有大小限制，不需要设置初始大小，也不需要设置文件的最大限制、扩展大小等参数。
* 对于使用多表空间特性的表，可以比较方便地进行单表备份和恢复操作，但是直接复制.ibd 文件是不行的，因为没有共享表空间的数据字典信息，直接复制的.ibd 文件和.frm 文件恢复时是不能被正确识别的，但可以通过以下命令:
```
 ALTER TABLE tbl_name DISCARD TABLESPACE;
 ALTER TABLE tbl_name IMPORT TABLESPACE;
```
将备份恢复到数据库中，但是这样的单表备份，只能恢复到表原来在的数据库中，而不能恢复到其他的数据库中。如果要将单表恢复到目标数据库，则需要通过 mysqldump 和 mysqlimport 来实现。
